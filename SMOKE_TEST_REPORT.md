# –°–º–æ—É–∫-—Ç–µ—Å—Ç –æ—Ç—á–µ—Ç - Profile MVP + Journal MVP

**–î–∞—Ç–∞:** 12 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ç–∫–∞:** `feat/profile-mvp`  
**Environment:** Production (Railway)

---

## ‚ö†Ô∏è –ü–†–ò–ú–ï–ß–ê–ù–ò–ï

**–í–∞–∂–Ω–æ:** –ü–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ–º –ø–æ–ª–Ω–æ–≥–æ —Å–º–æ—É–∫-—Ç–µ—Å—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
1. ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Railway (`pnpm prisma migrate deploy`)
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å bucket `journal-audio` –≤ Supabase Storage
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Railway

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö —à–∞–≥–æ–≤ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç.

---

## ‚úÖ –ü–†–û–í–ï–†–ï–ù–û (–ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)

### UI –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è
- ‚úÖ Hero —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (`/`)
- ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ (`/login`)
- ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (Sign in/Sign up –∫–Ω–æ–ø–∫–∏)
- ‚úÖ –ê–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üìã –ß–ï–ö–õ–ò–°–¢ –î–õ–Ø –ü–û–õ–ù–û–ì–û –°–ú–û–£–ö-–¢–ï–°–¢–ê

### 1. Auth
- [ ] –õ–æ–≥–∏–Ω –ø–æ–¥ USER ‚Üí —É—Å–ø–µ—à–Ω–æ
- [ ] –õ–æ–≥–∏–Ω –ø–æ–¥ ADMIN (email –∏–∑ ADMIN_EMAILS) ‚Üí —É—Å–ø–µ—à–Ω–æ
- [ ] USER –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–π—Ç–∏ –Ω–∞ `/admin` ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/dashboard`
- [ ] ADMIN –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ `/admin` ‚Üí –¥–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω

### 2. –ü—Ä–æ—Ñ–∏–ª—å
- [ ] –û—Ç–∫—Ä—ã—Ç—å `/dashboard` ‚Üí –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è SSR
- [ ] –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `fullName` ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (200)
- [ ] –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `locale`, `timezone`, `phone` ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- [ ] –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å `GET /api/profile` ‚Üí 401

### 3. –ñ—É—Ä–Ω–∞–ª - —Ç–µ–∫—Å—Ç
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—É—é –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É ‚Üí —É—Å–ø–µ—à–Ω–æ
- [ ] –ó–∞–ø–∏—Å—å –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ —Å—Ä–∞–∑—É ‚Üí –≤–∏–¥–Ω–∞
- [ ] –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Üí –∑–∞–ø–∏—Å—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- [ ] –ó–∞–π—Ç–∏ –ø–æ–¥ –¥—Ä—É–≥–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º ‚Üí –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–ø–∏—Å–∏

### 4. –ñ—É—Ä–Ω–∞–ª - –∞—É–¥–∏–æ
- [ ] –ù–∞–∂–∞—Ç—å Record ‚Üí –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
- [ ] –ó–∞–ø–∏—Å–∞—Ç—å 5-10 —Å–µ–∫ ‚Üí Stop ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è
- [ ] –§–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è ‚Üí —É—Å–ø–µ—à–Ω–æ (201)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Supabase Storage ‚Üí —Ñ–∞–π–ª –ø–æ –ø—É—Ç–∏ `user/<userId>/<yyyy>/<mm>/<dd>/<cuid>.webm`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î ‚Üí —Å–æ–∑–¥–∞–Ω—ã `AudioAsset` –∏ `JournalEntry` (type=AUDIO)
- [ ] –ó–∞–ø–∏—Å—å –≤–∏–¥–Ω–∞ –≤ —Å–ø–∏—Å–∫–µ –∫–∞–∫ "Audio note"
- [ ] –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —Å –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º MIME ‚Üí 415
- [ ] –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª > 20MB ‚Üí 413
- [ ] –ï—Å–ª–∏ bucket –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí 503

### 5. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Network tab ‚Üí Service Role Key –Ω–µ —É—Ç–µ–∫–∞–µ—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Railway ‚Üí —Å–µ–∫—Ä–µ—Ç—ã –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ ‚Üí `supabaseAdmin` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö

---

## üîç –ü–†–û–í–ï–†–ö–ê –ö–û–î–ê (–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑)

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ `SUPABASE_SERVICE_ROLE_KEY` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤:
  - `src/lib/supabaseServer.ts` (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π –º–æ–¥—É–ª—å)
  - `src/app/api/journal/upload/route.ts` (API route - —Å–µ—Ä–≤–µ—Ä–Ω—ã–π)
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç `supabaseAdmin`
- ‚úÖ –õ–æ–≥–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `console.error` –±–µ–∑ –≤—ã–≤–æ–¥–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤

### API –∑–∞—â–∏—Ç–∞
- ‚úÖ –í—Å–µ API —Ä–æ—É—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å–µ—Å—Å–∏—é —á–µ—Ä–µ–∑ `getServerAuthSession()`
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `session.user.id`
- ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–µ–∑–¥–µ

---

## üìù –ò–ù–°–¢–†–£–ö–¶–ò–ò –î–õ–Ø –†–£–ß–ù–û–ì–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –¢–µ—Å—Ç 1: –ü—Ä–æ—Ñ–∏–ª—å
```bash
# 1. –ó–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è
# 2. –û—Ç–∫—Ä—ã—Ç—å /dashboard
# 3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –ø—Ä–æ—Ñ–∏–ª—è (fullName, locale, timezone, phone)
# 4. –ù–∞–∂–∞—Ç—å Save
# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å
# 6. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Üí –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è
```

### –¢–µ—Å—Ç 2: –¢–µ–∫—Å—Ç–æ–≤–∞—è –∑–∞–ø–∏—Å—å
```bash
# 1. –ù–∞ /dashboard –Ω–∞–π—Ç–∏ —Ñ–æ—Ä–º—É "New Entry"
# 2. –í–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç –≤ textarea
# 3. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∑–∞–ø–æ–ª–Ω–∏—Ç—å title, mood, energy
# 4. –ù–∞–∂–∞—Ç—å Save
# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–ø–∏—Å—å –ø–æ—è–≤–∏–ª–∞—Å—å –≤ —Å–ø–∏—Å–∫–µ "My Entries"
# 6. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Üí –∑–∞–ø–∏—Å—å –¥–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞—Ç—å—Å—è
```

### –¢–µ—Å—Ç 3: –ê—É–¥–∏–æ –∑–∞–ø–∏—Å—å
```bash
# 1. –ù–∞ /dashboard –Ω–∞–π—Ç–∏ –±–ª–æ–∫ "Record Audio"
# 2. –ù–∞–∂–∞—Ç—å Record
# 3. –†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É
# 4. –ì–æ–≤–æ—Ä–∏—Ç—å 5-10 —Å–µ–∫—É–Ω–¥
# 5. –ù–∞–∂–∞—Ç—å Stop
# 6. –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≥—Ä—É–∑–∫–∏ (–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "Uploading...")
# 7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–ø–∏—Å—å –ø–æ—è–≤–∏–ª–∞—Å—å –≤ —Å–ø–∏—Å–∫–µ –∫–∞–∫ "Audio note"
# 8. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Supabase Storage ‚Üí —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ –ø—É—Ç–∏ user/<userId>/<yyyy>/<mm>/<dd>/<cuid>.webm
```

### –¢–µ—Å—Ç 4: –û—à–∏–±–∫–∏ API
```bash
# 1. –í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
# 2. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –æ—Ç–∫—Ä—ã—Ç—å /api/profile ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 401
# 3. –ó–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è
# 4. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —Å –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º MIME ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 415
# 5. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª > 20MB ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 413
```

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Railway**
   ```bash
   railway run pnpm prisma migrate deploy
   ```

2. **–°–æ–∑–¥–∞—Ç—å bucket –≤ Supabase**
   - –û—Ç–∫—Ä—ã—Ç—å: https://supabase.com/dashboard/project/gnywltdograatcpqhyzd
   - Storage ‚Üí New bucket ‚Üí `journal-audio` (Private)

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Railway**
   - –°–º. `CREDENTIALS.md` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞

4. **–ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—ã–π —Å–º–æ—É–∫-—Ç–µ—Å—Ç**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á–µ–∫–ª–∏—Å—Ç –≤—ã—à–µ
   - –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (pass/fail)

5. **–û—Ç–∫—Ä—ã—Ç—å PR**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑ `PR_DESCRIPTION.md`
   - –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–º–æ—É–∫-—Ç–µ—Å—Ç–∞

---

**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –∏ —Å–æ–∑–¥–∞–Ω–∏—è bucket

